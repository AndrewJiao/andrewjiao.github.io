

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="https://andrewblogs.oss-cn-heyuan.aliyuncs.com/base/toptag.png">
  <link rel="icon" href="https://andrewblogs.oss-cn-heyuan.aliyuncs.com/base/toptag.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Andrew_Jiao">
  <meta name="keywords" content="">
  
    <meta name="description" content="Redis介绍（缓存） Redis是一个开源的使用ANSIC语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库  为什么需要Redis？  CRUD操作中，80%是业务查询，20%是业务新增、删除、修改操作 数据不会频繁变更 支持当前主流分布式架构    Redis安装编译工具安装 安装redis运行环境（基于C语言）  12yum -y install gcc autom">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis">
<meta property="og:url" content="https://andrewjiao.github.io/2019/07/01/Redis/index.html">
<meta property="og:site_name" content="good day">
<meta property="og:description" content="Redis介绍（缓存） Redis是一个开源的使用ANSIC语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库  为什么需要Redis？  CRUD操作中，80%是业务查询，20%是业务新增、删除、修改操作 数据不会频繁变更 支持当前主流分布式架构    Redis安装编译工具安装 安装redis运行环境（基于C语言）  12yum -y install gcc autom">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/redis_loading.png">
<meta property="og:image" content="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/redis_help.png">
<meta property="og:image" content="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/person_value.png">
<meta property="og:image" content="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/pipe_input.png">
<meta property="og:image" content="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/redis_client1.png">
<meta property="og:image" content="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/jedis_client.png">
<meta property="og:image" content="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/jedis_client1.png">
<meta property="og:image" content="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/hash1.png">
<meta property="og:image" content="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/hash2.png">
<meta property="article:published_time" content="2019-07-01T15:31:30.000Z">
<meta property="article:modified_time" content="2021-05-16T17:12:56.870Z">
<meta property="article:author" content="Andrew_Jiao">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/redis_loading.png">
  
  
  
  <title>Redis - good day</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"andrewjiao.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>hello there</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://andrewblogs.oss-cn-heyuan.aliyuncs.com/base/baseHeader.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Redis"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2019-07-01 23:31" pubdate>
          2019年7月1日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7.8k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          66 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Redis</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Redis介绍（缓存）"><a href="#Redis介绍（缓存）" class="headerlink" title="Redis介绍（缓存）"></a>Redis介绍（缓存）</h1><ul>
<li><p>Redis是一个开源的使用ANSIC语言编写、支持网络、可基于内存亦可<a target="_blank" rel="noopener" href="https://baike.sogou.com/lemma/ShowInnerLink.htm?lemmaId=10894095&ss_c=ssc.citiao.link">持久化</a>的日志型、Key-Value数据库</p>
</li>
<li><p>为什么需要Redis？</p>
<ul>
<li>CRUD操作中，80%是业务查询，20%是业务新增、删除、修改操作</li>
<li>数据不会频繁变更</li>
<li>支持当前主流分布式架构</li>
</ul>
</li>
</ul>
<h1 id="Redis安装"><a href="#Redis安装" class="headerlink" title="Redis安装"></a>Redis安装</h1><h2 id="编译工具安装"><a href="#编译工具安装" class="headerlink" title="编译工具安装"></a>编译工具安装</h2><ul>
<li>安装redis运行环境（基于C语言）</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown">yum -y install gcc automake autoconf libtool make				#gcc编译环境<br>yum -y install lrzsz								  		  #文件上传组件<br></code></pre></td></tr></table></figure>

<ul>
<li>关于yum命令<ul>
<li>yum（ Yellow dog Updater, Modified）是一个在Fedora和RedHat以及SUSE中的Shell前端软件包管理器。</li>
<li>基於RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软体包，无须繁琐地一次次下载、安装</li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/linux/linux-yum.html">相关链接</a></li>
</ul>
</li>
</ul>
<h2 id="linux安装Redis"><a href="#linux安装Redis" class="headerlink" title="linux安装Redis"></a>linux安装Redis</h2><ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/">获取Redis安装包</a></li>
</ul>
<p><img src="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/redis_loading.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>执行linux命令下载并安装Redis</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> –p /usr/local/src/redis<br><span class="hljs-built_in">cd</span> /usr/local/src/redis<br>wget http://download.redis.io/releases/redis-5.0.0.tar.gz<br>tar xzf redis-5.0.0.tar.gz 							<span class="hljs-comment">#解压tar xvf redis-3.0.7.tar.gz</span><br><span class="hljs-built_in">cd</span> redis-5.0.0<br>make												<span class="hljs-comment">#下载后编译，过程稍长</span><br>make install										<span class="hljs-comment">#进行安装</span><br>make PREFIX=/usr/local/src/redis install				<span class="hljs-comment">#指定安装目录</span><br><br></code></pre></td></tr></table></figure>

<ul>
<li>启动配置</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-server 					<span class="hljs-comment">#默认找redis.conf配置文件</span><br>redis-server &amp;					<span class="hljs-comment">#上面ctrl+c中断reis会退出，这个不会</span><br>redis-server redis6380.conf	<span class="hljs-comment">#指定配置文件，这样可以启动多个实例</span><br><span class="hljs-comment">#注意两种启动方式的差异</span><br>ps -ef|grep redis  				<span class="hljs-comment">#查看是否有后台服务</span><br>root      3511     1  0 16:29 ?   00:00:01 redis-server *:6379<br>root      3515     1  0 16:29 ?   00:00:01 redis-server 127.0.0.1:6380<br>注释掉redis.conf配置文件中的48行；# <span class="hljs-built_in">bind</span> 127.0.0.1 ::1即可<br><br></code></pre></td></tr></table></figure>

<ul>
<li>查看版本</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-server –v<br>Redis server v=3.2.5 sha=00000000:0 malloc=jemalloc-4.0.3 bits=64 build=e6c4c3113548f6b0<br>redis-cli –v<br></code></pre></td></tr></table></figure>

<ul>
<li>详细信息</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli					<span class="hljs-comment">#需要进入redis客户端查看</span><br>127.0.0.1:6379&gt; info		<span class="hljs-comment">#查看当前redis节点的详细配置信息</span><br></code></pre></td></tr></table></figure>

<h1 id="redis常用命令"><a href="#redis常用命令" class="headerlink" title="redis常用命令"></a>redis常用命令</h1><h2 id="测试服务是否正常"><a href="#测试服务是否正常" class="headerlink" title="测试服务是否正常"></a>测试服务是否正常</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#默认连接：IP 127.0.0.1 端口 6379</span><br>redis-cli<br><span class="hljs-comment">#指定IP端口：</span><br>redis-cli –h 127.0.0.1 –p 6379<br><span class="hljs-comment">#Redis提供了PING-PONG机制，测试与客户端和服务器链接是否正常</span><br>redis-cli ping<br><span class="hljs-comment">#或</span><br>redis-cli<br>redis 127.0.0.1:6379&gt;ping<br>PONG<br><br></code></pre></td></tr></table></figure>

<h2 id="redis场景命令回复"><a href="#redis场景命令回复" class="headerlink" title="redis场景命令回复"></a>redis场景命令回复</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#状态回复（最简单的回复-redis提供的测试命令）</span><br>redis&gt;PING<br>PONG<br>127.0.0.1:6379&gt;SET <span class="hljs-built_in">test</span> 123<br>OK<br><span class="hljs-comment">#错误回复（以error开头，后面跟着错误信息）</span><br>127.0.0.1:6379&gt;TEST<br>(error) ERR unknown <span class="hljs-built_in">command</span> <span class="hljs-string">&#x27;TEST&#x27;</span><br><span class="hljs-comment">#整数回复</span><br>127.0.0.1:6379&gt;INCR test_incr<br>(<span class="hljs-built_in">integer</span>) 1<br><span class="hljs-comment">#字符串回复（最长久的一种回复，双引号包裹）</span><br>127.0.0.1:6379&gt;get <span class="hljs-built_in">test</span><br>“123”<br><span class="hljs-comment">#多行字符串回复</span><br>127.0.0.1:6379&gt;KEYS *<br>1) <span class="hljs-string">&quot;test_incr&quot;</span><br>2) <span class="hljs-string">&quot;test&quot;</span><br><br></code></pre></td></tr></table></figure>

<h2 id="Redis退出"><a href="#Redis退出" class="headerlink" title="Redis退出"></a>Redis退出</h2><ul>
<li>exit</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#退出--只会退出客户端</span><br>127.0.0.1:6379&gt; <span class="hljs-built_in">exit</span><br><span class="hljs-comment">#关闭--将关闭整个Redis服务</span><br>127.0.0.1:6379&gt; shutdown<br></code></pre></td></tr></table></figure>

<h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><h3 id="keys"><a href="#keys" class="headerlink" title="keys"></a>keys</h3><ul>
<li>字符串类型是redis中最基本的数据类型，它能存储任何形式的字符串，包括二进制数据。可以存储JSON化的对象、字节数组等。一个字符串类型键允许存储的数据最大容量是512MB。</li>
<li>赋值与取值：<ul>
<li><code>SET key value</code></li>
<li><code>GET key</code></li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">127.0.0.1:6379&gt; keys *<br>(empty list or <span class="hljs-built_in">set</span>)<br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> <span class="hljs-built_in">test</span> 123<br>OK<br>127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> test1 ab<br>OK<br>127.0.0.1:6379&gt; keys *<br>1) <span class="hljs-string">&quot;test1&quot;</span><br>2) <span class="hljs-string">&quot;test&quot;</span><br>127.0.0.1:6379&gt; get <span class="hljs-built_in">test</span><br><span class="hljs-string">&quot;123&quot;</span><br>127.0.0.1:6379&gt; get test1<br><span class="hljs-string">&quot;abc&quot;</span><br>127.0.0.1:6379&gt; get test2<br>(nil)<br>127.0.0.1:6379&gt;<br></code></pre></td></tr></table></figure>

<h3 id="keys通配符"><a href="#keys通配符" class="headerlink" title="keys通配符"></a>keys通配符</h3><ul>
<li>获取符合规则的建名列表。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">KEYS *<br>keys <span class="hljs-built_in">test</span>[_]*<br>keys t[a-d]<br>说明：<br>？	匹配一个字符<br>*   匹配任意个（包括0个）字符<br>[]  匹配括号间的任一字符，可以使用“-“表示范围。如a[a-d]匹配ab/ac/ad<br>\x	匹配字符x，用于转义符合，如果要匹配“？“就需要使用\?<br></code></pre></td></tr></table></figure>

<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><ul>
<li>redis默认支持16个数据库，对外都是以一个从0开始的递增数字命名，可以通过参数database来修改默认数据库个数。客户端连接redis服务后会自动选择0号数据库，可以通过select命令更换数据库，例如选择1号数据库：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">127.0.0.1:6379&gt;SELECT 1<br>OK<br>127.0.0.1:6379&gt;GET <span class="hljs-built_in">test</span><br>(nil)<br></code></pre></td></tr></table></figure>

<ul>
<li>注意<ul>
<li>Redis不支持自定义数据库名称。</li>
<li>Redis不支持为每个数据库设置访问密码。</li>
<li>Redis的多个数据库之间不是安全隔离的，FLUSHALL命令会清空所有数据库的数据。</li>
</ul>
</li>
</ul>
<h3 id="clear"><a href="#clear" class="headerlink" title="clear"></a>clear</h3><ul>
<li>清除屏幕中的内容</li>
</ul>
<h3 id="exists"><a href="#exists" class="headerlink" title="exists"></a>exists</h3><ul>
<li>判断Redis中的某个键是否存在<ul>
<li>如果存在返回1</li>
<li>不存在返回0</li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">1) <span class="hljs-string">&quot;name&quot;</span><br>2) <span class="hljs-string">&quot;num&quot;</span><br>127.0.0.1:6379&gt; exists name<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; exists name2<br>(<span class="hljs-built_in">integer</span>) 0<br></code></pre></td></tr></table></figure>

<h3 id="del"><a href="#del" class="headerlink" title="del"></a>del</h3><ul>
<li>删除一个或多个键，用空格隔开表示多个键</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">127.0.0.1:6379&gt; keys *<br>1) <span class="hljs-string">&quot;name&quot;</span><br>2) <span class="hljs-string">&quot;num&quot;</span><br>127.0.0.1:6379&gt; del name num<br>(<span class="hljs-built_in">integer</span>) 2<br>127.0.0.1:6379&gt; keys *<br>(empty list or <span class="hljs-built_in">set</span>)<br></code></pre></td></tr></table></figure>

<h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><ul>
<li>获得键值的数据类型，返回值可能是string（字符串）、hash（散列类型）、list（列表类型）、set（集合类型）、zset（有序集合类型）。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">127.0.0.1:6379&gt; keys *<br>1) <span class="hljs-string">&quot;test1&quot;</span><br>2) <span class="hljs-string">&quot;test&quot;</span><br>127.0.0.1:6379&gt; <span class="hljs-built_in">type</span> <span class="hljs-built_in">test</span><br>string<br>127.0.0.1:6379&gt; <span class="hljs-built_in">type</span> test1<br>string<br></code></pre></td></tr></table></figure>

<h3 id="help"><a href="#help" class="headerlink" title="help"></a>help</h3><ul>
<li>获取命令帮助</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">127.0.0.1:6379&gt; <span class="hljs-built_in">help</span> <span class="hljs-built_in">type</span><br><br>  TYPE key<br>  summary: Determine the <span class="hljs-built_in">type</span> stored at key<br>  since: 1.0.0<br>  group: generic<br></code></pre></td></tr></table></figure>

<ul>
<li>也可在<a target="_blank" rel="noopener" href="http://www.redis.io/">Redis官网</a>直接获取帮助</li>
</ul>
<p><img src="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/redis_help.png" srcset="/img/loading.gif" lazyload alt="redis_help"></p>
<h3 id="flushall-flushdb"><a href="#flushall-flushdb" class="headerlink" title="flushall&#x2F;flushdb"></a>flushall&#x2F;flushdb</h3><ul>
<li>清除数据库<ol>
<li>flushall清除所有数据库</li>
<li>flushdb清除当前数据库</li>
</ol>
</li>
</ul>
<h2 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h2><ul>
<li><p>设置num为key</p>
</li>
<li><p>递增递减</p>
<ul>
<li><code>incr num</code>  为num递增1</li>
<li><code>incrby num 3</code> 为num递增3</li>
<li>如果num不存在，则自动会创建，如果存在自动+1</li>
<li><code>decr num</code> 为num递减1</li>
<li><code>decrby num 3</code> 为num递减3</li>
</ul>
</li>
<li><p>浮点递增</p>
<ul>
<li>浮点递增会有精度问题，2.8.7注意在新版本中已经修正了这个浮点精度问题。3.0.7</li>
<li><code>incrbyfloat num 0.3</code> 为num递增0.3</li>
</ul>
</li>
<li><p>字符串拼接</p>
<ul>
<li>向尾部追加值。如果键不存在则创建该键，其值为写的value，即相当于SET key<br>value。返回值是追加后字符串的总长度。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; keys *<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;num&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;test1&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;test&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; get test<br><span class="hljs-string">&quot;123&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; append test <span class="hljs-string">&quot;abc&quot;</span><br>(integer) <span class="hljs-number">6</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; get test<br><span class="hljs-string">&quot;123abc&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt;<br></code></pre></td></tr></table></figure>
</li>
<li><p>返回键值字符串长度</p>
<ul>
<li>如果键不存在则返回0。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; set name dsfjawoeijfoaewjf;aijefj<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; strlen <span class="hljs-title function_">name</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">24</span><br><span class="hljs-comment">//注意，如果键值为空串，返回也是0。</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>多key赋值</p>
<ul>
<li>同时设置&#x2F;获取多个键值</li>
<li>语法：<ul>
<li><code>MSET keyvalue [key value …]</code></li>
<li><code>MGET key [key …]</code></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; mset a <span class="hljs-number">1</span> b <span class="hljs-number">2</span> c <span class="hljs-number">3</span><br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; mget a b c<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;2&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="Redis生存时间"><a href="#Redis生存时间" class="headerlink" title="Redis生存时间"></a>Redis生存时间</h1><ul>
<li><p>expire</p>
<ul>
<li>Redis在实际使用过程中更多的用作缓存，然而缓存的数据一般都是需要设置生存时间的，即到期后数据自动销毁</li>
<li>语法：<code>EXPIRE key seconds</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; flushall<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; set bomb tnt<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; expire bomb <span class="hljs-number">10</span><br>(integer) <span class="hljs-number">1</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">5</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">3</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">3</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">2</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">1</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> -<span class="hljs-number">2</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> -<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<ul>
<li>TTL查看key的剩余时间，当返回值为-2时，表示键被删除。</li>
<li>当 key 不存在时，返回 -2 。当 key 存在但没有设置剩余生存时间时，返回 -1 。 否则，以毫秒为单位，返回<br>key 的剩余生存时间。</li>
<li>注意：在 Redis 2.8以前，当 key 不存在，或者 key 没有设置剩余生存时间时，命令都返回 -1 。</li>
</ul>
</li>
<li><p>persist</p>
<ul>
<li>语法：persist key</li>
<li>重新将键值持久化</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; set bomb tnt<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; expire bomb <span class="hljs-number">60</span><br>(integer) <span class="hljs-number">1</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">49</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; persist <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">1</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> -<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>pexpire</p>
<ul>
<li>语法：<code>pexpire key milliseconds</code></li>
<li>设置生存时间为毫秒，可以做到更精确的控制。</li>
<li>可用于秒杀业务</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; set bomb tnt<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; pexpire bomb <span class="hljs-number">10000</span><br>(integer) <span class="hljs-number">1</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">6</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">3</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ttl <span class="hljs-title function_">bomb</span><br><span class="hljs-params">(integer)</span> -<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="Redis的hash使用"><a href="#Redis的hash使用" class="headerlink" title="Redis的hash使用"></a>Redis的hash使用</h1><ul>
<li>假设有User对象以JSON序列化的形式存储到redis中，User对象有id、username、password、age、name等属性，存储的过程如下：<ul>
<li>User对象-&gt;json(string)-&gt;redis</li>
</ul>
</li>
<li>如果在业务上只是更新age属性，则需要Redis数据类型的散列类型hash</li>
<li>散列类型存储了字段（field）和字段值的映射，<strong>但字段值只能是字符串</strong>，不支持其他类型，也就是说，散列类型不能嵌套其他的数据类型。一个散列类型可以包含最多232-1个字段。</li>
</ul>
<p><img src="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/person_value.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="hash基础命令"><a href="#hash基础命令" class="headerlink" title="hash基础命令"></a>hash基础命令</h2><ul>
<li>hget、hset、hincrby、hmset、hmget、hexists、hdel增删改查字符串操作等与普通字符串类型一致，但取值或操作时需考虑字段值的添加<ul>
<li>语法：基础命令 键 字段 （值）</li>
<li>案例：<code>hincrby person age 2 或 hlen person name</code></li>
</ul>
</li>
<li>hgetall<ul>
<li>获取所有字段和值</li>
</ul>
</li>
<li>hlen<ul>
<li>获取字段数量</li>
</ul>
</li>
<li>hkeys&#x2F;hvals<ul>
<li>只获属性或只获取属性值</li>
</ul>
</li>
</ul>
<h2 id="Jedis演示"><a href="#Jedis演示" class="headerlink" title="Jedis演示"></a>Jedis演示</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.redis;<br><br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;<br><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisPoolDemoCMD</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 构建连接池配置信息</span><br>        <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">jedisPoolConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();<br>        <span class="hljs-comment">// 设置最大连接数</span><br>        jedisPoolConfig.setMaxTotal(<span class="hljs-number">50</span>);<br><br>        <span class="hljs-comment">// 构建连接池</span><br>        <span class="hljs-type">JedisPool</span> <span class="hljs-variable">jedisPool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(jedisPoolConfig, <span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6379</span>);<br><br>        <span class="hljs-comment">// 从连接池中获取连接</span><br>        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> jedisPool.getResource();<br><br>        jedis.hset(<span class="hljs-string">&quot;USER_1&quot;</span>, <span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;zhangsan&quot;</span>);<br>        jedis.hset(<span class="hljs-string">&quot;USER_1&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>        <br>        Map&lt;String, String&gt; val = jedis.hgetAll(<span class="hljs-string">&quot;USER_1&quot;</span>);<br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; entry : val.entrySet()) &#123;<br>            System.out.println(entry.getKey() + <span class="hljs-string">&quot;  &quot;</span> + entry.getValue());<br>        &#125;<br><br>        <span class="hljs-comment">// 将连接还回到连接池中</span><br>        jedisPool.returnResource(jedis);<br><br>        <span class="hljs-comment">// 释放连接池</span><br>        jedisPool.close();<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//redis中测试</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; hgetall USER_1<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;username&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;zhangsan&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;password&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;123456&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; hgetall <span class="hljs-title function_">user_1</span><br><span class="hljs-params">(empty list or set)</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt;<br><span class="hljs-comment">//注意：key值的大小写是区分的。</span><br></code></pre></td></tr></table></figure>

<h1 id="Redis的List使用"><a href="#Redis的List使用" class="headerlink" title="Redis的List使用"></a>Redis的List使用</h1><ul>
<li>一个列表最多可以包含232-1个元素（4294967295，每个表超过近43亿个元素）</li>
<li>Redis的list类型其实就是一个每个子元素都是string类型的双向链表。可以通过push,pop操作从链表的头部或者尾部添加删除元素。这使得list既可以用作栈，也可以用作队列。</li>
<li>有意思的是list的pop操作还有阻塞版本的，<strong>当我们[lr]pop一个list对象时，如果list是空，或者不存在，会立即返回nil。但是阻塞版本的b[lr]pop则可以阻塞，当然可以加超时时间，超时后也会返回nil。</strong><u>为什么要阻塞版本的pop呢，主要是为了避免轮询</u>。举个简单的例子如果我们用list来实现一个工作队列。执行任务的thread可以调用阻塞版本的pop去获取任务这样就可以避免轮询去检查是否有任务存在。当任务来时候工作线程可以立即返回，也可以避免轮询带来的延迟。</li>
</ul>
<h2 id="List的基本命令"><a href="#List的基本命令" class="headerlink" title="List的基本命令"></a>List的基本命令</h2><ul>
<li>lpush</li>
<li>在key对应list的头部添加字符串元素</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lpush career <span class="hljs-title function_">teacher</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">1</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lpush career <span class="hljs-title function_">doctor</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">2</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lpush career <span class="hljs-title function_">student</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">3</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange career <span class="hljs-number">0</span> -<span class="hljs-number">1</span><span class="hljs-comment">//0 -1可以输出全部</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;student&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;doctor&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;teacher&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>rpush</li>
<li>在key对应list的尾部添加字符串元素（r是右边l是左边）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; rpush career <span class="hljs-title function_">worker</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">4</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; rpush career <span class="hljs-title function_">engnieer</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">5</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange career <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;student&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;doctor&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;teacher&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;worker&quot;</span><br><span class="hljs-number">5</span>) <span class="hljs-string">&quot;engnieer&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>lrange</li>
<li>查看list(start end)   – 0到-1可以查看所有内容</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange career <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;student&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;doctor&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;teacher&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;worker&quot;</span><br><span class="hljs-number">5</span>) <span class="hljs-string">&quot;engnieer&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>del</li>
<li>同基本String类型操作删除这个list</li>
<li>linsert</li>
<li>在key对应list的特定位置之前或之后添加字符串元素</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; LINSERT career after worker <span class="hljs-title function_">worker1</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">6</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange career <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;student&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;doctor&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;teacher&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;worker&quot;</span><br><span class="hljs-number">5</span>) <span class="hljs-string">&quot;worker1&quot;</span><br><span class="hljs-number">6</span>) <span class="hljs-string">&quot;engnieer&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>lset</li>
<li>设置list中指定下标的元素值<ul>
<li>当下标中有元素则会替换</li>
<li>负数从尾部计数，第一个数为-1</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange career <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;student&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;doctor&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;teacher&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;worker&quot;</span><br><span class="hljs-number">5</span>) <span class="hljs-string">&quot;worker1&quot;</span><br><span class="hljs-number">6</span>) <span class="hljs-string">&quot;engnieer&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lset career <span class="hljs-number">4</span> worker(set)<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange career <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;student&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;doctor&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;teacher&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;worker&quot;</span><br><span class="hljs-number">5</span>) <span class="hljs-string">&quot;worker(set)&quot;</span><br><span class="hljs-number">6</span>) <span class="hljs-string">&quot;engnieer&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>lrem</li>
<li>根据count参数按顺序从删除与参数value相同的值<ul>
<li>count&gt;0顺序删除</li>
<li>count&lt;0逆序删除</li>
<li>count&#x3D;0删除所有</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange career <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br> <span class="hljs-number">1</span>) <span class="hljs-string">&quot;student&quot;</span><br> <span class="hljs-number">2</span>) <span class="hljs-string">&quot;doctor&quot;</span><br> <span class="hljs-number">3</span>) <span class="hljs-string">&quot;teacher&quot;</span><br> <span class="hljs-number">4</span>) <span class="hljs-string">&quot;worker&quot;</span><br> <span class="hljs-number">5</span>) <span class="hljs-string">&quot;salier&quot;</span><br> <span class="hljs-number">6</span>) <span class="hljs-string">&quot;engnieer&quot;</span><br> <span class="hljs-number">7</span>) <span class="hljs-string">&quot;worker&quot;</span><br> <span class="hljs-number">8</span>) <span class="hljs-string">&quot;worker&quot;</span><br> <span class="hljs-number">9</span>) <span class="hljs-string">&quot;worker&quot;</span><br><span class="hljs-number">10</span>) <span class="hljs-string">&quot;worker&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrem career -<span class="hljs-number">4</span> worker<br>(integer) <span class="hljs-number">4</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange career <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;student&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;doctor&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;teacher&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;worker&quot;</span><br><span class="hljs-number">5</span>) <span class="hljs-string">&quot;salier&quot;</span><br><span class="hljs-number">6</span>) <span class="hljs-string">&quot;engnieer&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>ltrim</li>
<li>根据参数范围，参数范围以外的值全删除</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">redis <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; rpush mylist8 <span class="hljs-string">&quot;one&quot;</span><br>(integer) <span class="hljs-number">1</span><br>redis <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; rpush mylist8 <span class="hljs-string">&quot;two&quot;</span><br>(integer) <span class="hljs-number">2</span><br>redis <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; rpush mylist8 <span class="hljs-string">&quot;three&quot;</span><br>(integer) <span class="hljs-number">3</span><br>redis <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; rpush mylist8 <span class="hljs-string">&quot;four&quot;</span><br>(integer) <span class="hljs-number">4</span><br>redis <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; ltrim mylist8 <span class="hljs-number">1</span> -<span class="hljs-number">1</span><br>OK<br>redis <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange mylist8 <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;two&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;three&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;four&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>lpop</li>
<li>从list的头部（左边）删除元素并返回删除的值</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange career <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;student&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;doctor&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;teacher&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;worker&quot;</span><br><span class="hljs-number">5</span>) <span class="hljs-string">&quot;salier&quot;</span><br><span class="hljs-number">6</span>) <span class="hljs-string">&quot;engnieer&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lpop career<br><span class="hljs-string">&quot;student&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>rpop</li>
<li>从list的尾部（右边）删除元素，并返回删除元素</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange career <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;student2&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;student&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;doctor&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;teacher&quot;</span><br><span class="hljs-number">5</span>) <span class="hljs-string">&quot;worker&quot;</span><br><span class="hljs-number">6</span>) <span class="hljs-string">&quot;salier&quot;</span><br><span class="hljs-number">7</span>) <span class="hljs-string">&quot;engnieer&quot;</span><br><span class="hljs-number">8</span>) <span class="hljs-string">&quot;student3&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; rpop career<br><span class="hljs-string">&quot;student3&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>llen</li>
<li>返回List的长度</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; llen <span class="hljs-title function_">career</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">7</span><br></code></pre></td></tr></table></figure>

<ul>
<li>lindex</li>
<li>返回指定下标的元素（不删除元素）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lindex career <span class="hljs-number">3</span><br><span class="hljs-string">&quot;teacher&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; llen <span class="hljs-title function_">career</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">7</span><br></code></pre></td></tr></table></figure>

<ul>
<li>rpoplpush</li>
<li>从第一个list尾部取出数据从头放到第二个list中，并返回删除的数据值</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; RPOPLPUSH career newcareer<br><span class="hljs-string">&quot;engnieer&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; lrange newcareer <span class="hljs-number">0</span> -<span class="hljs-number">1</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;engnieer&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><strong>利用链表形成安全的消息队列</strong></li>
<li>RPOPLPUSH命令实现安全消息队列。Redis链表经常会被用于消息队列的服务，以完成多程序之间的消息交换。假设一个应用程序正在执行LPUSH操作向链表中添加新的元素，我们通常将这样的程序称之为”生产者(Producer)”，而另外一个应用程序正在执行RPOP操作从链表中取出元素，我们称这样的程序为”消费者(Consumer)”。如果此时，消费者程序在取出消息元素后立刻崩溃，由于该消息已经被取出且没有被正常处理，那么我们就可以认为该消息已经丢失，由此可能会导致业务数据丢失，或业务状态的不一致等现象的发生。然而通过使用RPOPLPUSH命令，消费者程序在从主消息队列中取出消息之后再将其插入到备份队列中，直到消费者程序完成正常的处理逻辑后再将该消息从备份队列中删除。同时我们还可以提供一个守护进程，当发现备份队列中的消息过期时，可以重新将其再放回到主消息队列中，以便其它的消费者程序继续处理。</li>
</ul>
<h1 id="Redis的set使用"><a href="#Redis的set使用" class="headerlink" title="Redis的set使用"></a>Redis的set使用</h1><ul>
<li><p>Redis的Set是string类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。Redis中集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。集合中最大的成员数为232 - 1 (4294967295每个集合可存储40多亿个成员)</p>
<h2 id="sadd"><a href="#sadd" class="headerlink" title="sadd"></a>sadd</h2><ul>
<li>添加元素，重复元素添加失败，返回0</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; sadd family <span class="hljs-title function_">sister</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">1</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; sass family <span class="hljs-title function_">sister</span><br><span class="hljs-params">(error)</span> ERR unknown command `sass`, with args beginning with: `family`, `sister`, <br></code></pre></td></tr></table></figure>

<h2 id="smember"><a href="#smember" class="headerlink" title="smember"></a>smember</h2><ul>
<li>获取set集合中的所有内容</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; SMEMBERS family<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;father&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;sister&quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="spop"><a href="#spop" class="headerlink" title="spop"></a>spop</h2><ul>
<li>移除并返回set集合中指定count数的元素</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; spop family <span class="hljs-number">2</span><br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;father&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;sister&quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="scard"><a href="#scard" class="headerlink" title="scard"></a>scard</h2><ul>
<li>获取成员个数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; scard <span class="hljs-title function_">family</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure>

<h2 id="smove"><a href="#smove" class="headerlink" title="smove"></a>smove</h2><ul>
<li>移动一个元素到另外一个set集合</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; SMEMBERS family<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;daughter&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;father&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;mother&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;syster&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; smove family family2 <span class="hljs-title function_">syster</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">1</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; SMEMBERS family2<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;syster&quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="sunion"><a href="#sunion" class="headerlink" title="sunion"></a>sunion</h2><ul>
<li>将两个set集合并集</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; sunion family family2<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;father&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;daughter&quot;</span><br><span class="hljs-number">3</span>) <span class="hljs-string">&quot;syster&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;mother&quot;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="Redis灾难恢复模式"><a href="#Redis灾难恢复模式" class="headerlink" title="Redis灾难恢复模式"></a>Redis灾难恢复模式</h1><h2 id="rdb和aof比较"><a href="#rdb和aof比较" class="headerlink" title="rdb和aof比较"></a>rdb和aof比较</h2><table>
<thead>
<tr>
<th align="center">RDB</th>
<th align="center">AOF</th>
</tr>
</thead>
<tbody><tr>
<td align="center">fork一个进程，遍历hashtable，利用copy onwrite，把整个db dump保存下来。save,shutdown, slave 命令会触发这个操作。</td>
<td align="center">把写操作指令，持续的写到一个类似日志文件里。（类似于从postgresql等数据库导出sql一样，只记录写操作）</td>
</tr>
<tr>
<td align="center">粒度比较大，如果save, shutdown, slave 之前crash了，则中间的操作没办法恢复。</td>
<td align="center">粒度较小，crash之后，只有crash之前没有来得及做日志的操作没办法恢复。</td>
</tr>
</tbody></table>
<ul>
<li>两种区别就是，一个是持续的用日志记录写操作，crash（崩溃）后利用日志恢复；一个是平时写操作的时候不触发写，只有手动提交save命令，或者是shutdown关闭命令时，才触发备份操作。</li>
<li>选择的标准，就是看系统是愿意牺牲一些性能，换取更高的缓存一致性（aof），还是愿意写操作频繁的时候，不启用备份来换取更高的性能，待手动运行save的时候，再做备份（rdb）。rdb这个就更有些 最终一致性（eventually consistent）的意思了。</li>
</ul>
<h2 id="性能比较"><a href="#性能比较" class="headerlink" title="性能比较"></a>性能比较</h2><ul>
<li>测试方法是用java写的脚本对redis数据库进行写入，看写入速度。</li>
<li>100000&#x2F;300000&#x2F;1000000是数据量，插入的都是string。第一个数据是最小时间，第二个是平均，第三个是数据大小。</li>
</ul>
<table>
<thead>
<tr>
<th align="center">db类型</th>
<th align="center">最小时间</th>
<th align="center">评价时间</th>
<th align="center">数据大小</th>
</tr>
</thead>
<tbody><tr>
<td align="center">100000</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">dbmode</td>
<td align="center">4.8</td>
<td align="center">5.1</td>
<td align="center">1477792</td>
</tr>
<tr>
<td align="center">aofmode</td>
<td align="center">9.1</td>
<td align="center">9.3</td>
<td align="center">3677803</td>
</tr>
<tr>
<td align="center">300000</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">dbmode</td>
<td align="center">16.5</td>
<td align="center">17.6</td>
<td align="center">4877792</td>
</tr>
<tr>
<td align="center">aofmode</td>
<td align="center">21.1</td>
<td align="center">21.4</td>
<td align="center">11477803</td>
</tr>
<tr>
<td align="center">1000000</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">dbmode</td>
<td align="center">61</td>
<td align="center">65</td>
<td align="center">16777792</td>
</tr>
<tr>
<td align="center">aofmode</td>
<td align="center">77</td>
<td align="center">85</td>
<td align="center">38777849</td>
</tr>
</tbody></table>
<ul>
<li>从简单分析来看，aof比rdb慢25-80%，但是大规模数据都比较支持慢25%这端。估计在低数据量下，rdb模式更加占优势。数据规模增长时，速率比接近于4:5。aof的数据比rdb数据大150%（2.5倍上下），这点随着数据增长基本不变。</li>
<li>从读性能分析来看，两者差异不大。同样，数据分别是最小时间和平均时间。</li>
</ul>
<table>
<thead>
<tr>
<th align="center">db类型</th>
<th align="center">最小时间</th>
<th align="center">评价时间</th>
<th align="center">数据大小</th>
</tr>
</thead>
<tbody><tr>
<td align="center">dbmode</td>
<td align="center">55</td>
<td align="center">60</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">aofmode</td>
<td align="center">62</td>
<td align="center">63</td>
<td align="center"></td>
</tr>
</tbody></table>
<p>差异在10%以内，甚至比最小-平均差异还弱。基本可以视为一致</p>
<h1 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h1><h2 id="Redis的乐观锁机制"><a href="#Redis的乐观锁机制" class="headerlink" title="Redis的乐观锁机制"></a>Redis的乐观锁机制</h2><ul>
<li>大多数是基于数据版本（version）的记录机制实现的。即为数据增加一个版本标识，<strong>在基于数据库表的版本解决方案中，一般是通过为数据库表增加一个”version”字段来实现读取出数据时，将此版本号一同读出，之后更新时，对此版本号加1。此时，将提交数据的版本号与数据库表对应记录的当前版本号进行比对，如果提交的数据版本号大于数据库当前版本号，则予以更新，否则认为是过期数据。</strong></li>
<li>Redis也采用类似的机制，使用watch命令会监视给定的key，当exec时候如果监视的key从调用watch后发生过变化，则整个事务会失败。也可以调用watch多次监视多个key。这样就可以对指定的key加乐观锁了。注意watch的key是对整个连接有效的，事务也一样。如果连接断开，监视和事务都会被自动清除。当然exec，discard，unwatch命令都会清除连接中的所有监视。</li>
</ul>
<h2 id="Redis锁概念"><a href="#Redis锁概念" class="headerlink" title="Redis锁概念"></a>Redis锁概念</h2><ul>
<li>redis是单线程，提交命令时，其它命令无法插入其中，轻松利用单线程实现了事务的原子性。那如果执行多个redis命令呢？自然就没有事务保证，于是redis有下列相关的redis命令来实现事务管理。</li>
</ul>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">multi</td>
<td align="center">开启事务</td>
</tr>
<tr>
<td align="center">exec</td>
<td align="center">提交事务</td>
</tr>
<tr>
<td align="center">discard</td>
<td align="center">取消事务</td>
</tr>
<tr>
<td align="center">watch</td>
<td align="center">监控，如果监控的值发生变化，则提交事务时会失败</td>
</tr>
<tr>
<td align="center">unwatch</td>
<td align="center">去掉监控</td>
</tr>
</tbody></table>
<ul>
<li>Redis保证一个事务中的所有命令要么都执行，要么都不执行。如果在发送EXEC命令前客户端断线了，则Redis会清空事务队列，事务中的所有命令都不会执行。而一旦客户端发送了EXEC命令，所有的命令就都会被执行，即使此后客户端断线也没关系，因为Redis中已经记录了所有要执行的命令。</li>
</ul>
<h2 id="事务案例"><a href="#事务案例" class="headerlink" title="事务案例"></a>事务案例</h2><ul>
<li>例如：模拟转账，王有200，张有700，张给王转100。过程如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; set w <span class="hljs-number">200</span><br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; set z <span class="hljs-number">700</span><br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; mget w z<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;200&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;700&quot;</span><br>  ==================================事务开启============================================<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; multi<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; decrby z <span class="hljs-number">100</span><br>QUEUED			#注意此命令根本没有执行，而是把其放在一个队列中<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; incrby w <span class="hljs-number">100</span><br>QUEUED<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; mget w z<br>QUEUED<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; get w			#同时，这些相关的变量也不能再读取<br>QUEUED<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; get z<br>QUEUED<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; exec<br>==================================事务提交============================================<br><span class="hljs-number">1</span>) (integer) <span class="hljs-number">600</span><br><span class="hljs-number">2</span>) (integer) <span class="hljs-number">300</span><br><span class="hljs-number">3</span>) <span class="hljs-number">1</span>) <span class="hljs-string">&quot;300&quot;</span><br>   <span class="hljs-number">2</span>) <span class="hljs-string">&quot;600&quot;</span><br><span class="hljs-number">4</span>) <span class="hljs-string">&quot;300&quot;</span><br><span class="hljs-number">5</span>) <span class="hljs-string">&quot;600&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; mget w z<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;300&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;600&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt;<br><br></code></pre></td></tr></table></figure>

<ul>
<li>如果有错误则自动取消</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; mget w z<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;300&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;600&quot;</span><br>==================================事务开启============================================<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; multi<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; get w<br>QUEUED<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; set w <span class="hljs-number">100</span><br>QUEUED<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; abc<br>(error) ERR unknown command <span class="hljs-string">&#x27;abc&#x27;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; exec<br>==================================事务提交============================================<br>(error) EXECABORT Transaction discarded because of previous errors.<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; mget w z				#可以看出数据并未变化<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;300&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;600&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>discard取消事务</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; mget z w<br><span class="hljs-number">1</span>) <span class="hljs-string">&quot;600&quot;</span><br><span class="hljs-number">2</span>) <span class="hljs-string">&quot;300&quot;</span><br>==================================事务开启============================================<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; multi<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; incrby z <span class="hljs-number">100</span><br>QUEUED<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; discard<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; get z<br><span class="hljs-string">&quot;600&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; exec<br>==================================事务提交============================================<br>(error) ERR EXEC without MULTI<br><br></code></pre></td></tr></table></figure>

<ul>
<li>秒杀业务处理</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//客户端1</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; clear<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; set ticket <span class="hljs-number">1</span><br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; set money <span class="hljs-number">0</span><br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; watch ticket		#乐观锁，对值进行观察，改变则事务失败<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; multi				#开启事务<br>OK<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; decr ticket<br>QUEUED<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; incrby money <span class="hljs-number">100</span><br>QUEUED<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//客户端2</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; get ticket<br><span class="hljs-string">&quot;1&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; decr <span class="hljs-title function_">ticket</span><br><span class="hljs-params">(integer)</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//客户端1</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; exec<br>(nil)										#执行事务，失败<br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; get ticket<br><span class="hljs-string">&quot;0&quot;</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span>&gt; unwatch					#取消监控<br></code></pre></td></tr></table></figure>

<h1 id="Redis海量数据导入"><a href="#Redis海量数据导入" class="headerlink" title="Redis海量数据导入"></a>Redis海量数据导入</h1><ul>
<li>由于做性能测试，需要往redis中导出千万级的数据。得知redis-cli工具支持pipeline导入可以达到最佳性能。测试下500万条命令导入耗时43秒</li>
<li>将脚本写入文件用<code>redis-cli --pipe</code>导入<ul>
<li>cat d.txt |redis-cli –pipe</li>
</ul>
</li>
<li>格式要求<ul>
<li><a target="_blank" rel="noopener" href="http://redis.io/topics/mass-insert">官方文档</a></li>
<li>数据格式要求<ol>
<li>以*开始</li>
<li>*n n代表此条命令分成n个部分</li>
<li>每个部分以\r\n结束</li>
</ol>
</li>
</ul>
</li>
<li>案例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">set name tony 表达为：<br>*<span class="hljs-number">3</span>\r\n<br>$<span class="hljs-number">3</span>\r\n<br>set\r\n<br>$<span class="hljs-number">4</span>\r\n<br>name\r\n<br>$<span class="hljs-number">4</span>\r\n<br>tony\r\n<br><span class="hljs-comment">//注意：此处的\r\n为换行符，不是输入的字符。</span><br></code></pre></td></tr></table></figure>

<p><img src="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/pipe_input.png" srcset="/img/loading.gif" lazyload alt="pipe"></p>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> redis;<br><br><span class="hljs-keyword">import</span> java.io.BufferedWriter;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.OutputStreamWriter;<br><span class="hljs-keyword">import</span> java.io.UnsupportedEncodingException;<br><br><span class="hljs-keyword">import</span> org.junit.Test;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestRedisPipe</span> &#123;<br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * 格式化成输入字符串</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">private</span> String <span class="hljs-title function_">getString</span><span class="hljs-params">(String... args)</span> &#123;<br>		<span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>		sb.append(<span class="hljs-string">&quot;*&quot;</span>).append(args.length).append(<span class="hljs-string">&quot;\r\n&quot;</span>);<br>		<span class="hljs-keyword">for</span> (String arg : args) &#123;<br>			sb.append(<span class="hljs-string">&quot;$&quot;</span>).append(arg.length()).append(<span class="hljs-string">&quot;\r\n&quot;</span>);<br>			sb.append(arg).append(<span class="hljs-string">&quot;\r\n&quot;</span>);<br>		&#125;<br>		<span class="hljs-keyword">return</span> sb.toString();<br>	&#125;<br><br>	<span class="hljs-meta">@Test</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initFile2</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-type">Long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>		<span class="hljs-type">String</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;d:\\d.txt&quot;</span>;<br>		<span class="hljs-type">BufferedWriter</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>		<span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>		<span class="hljs-keyword">try</span> &#123;<br>			w = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedWriter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OutputStreamWriter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(file), <span class="hljs-string">&quot;utf-8&quot;</span>));<br>			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">100000000</span> ;i &lt; <span class="hljs-number">100100000</span>;i++)&#123;<br>			<span class="hljs-comment">//for (int i = 1; i &lt;= 100; i++) &#123;</span><br>	<span class="hljs-keyword">if</span> (i / <span class="hljs-number">30000</span> == <span class="hljs-number">0</span>) &#123;<br>					w.flush();<br>				&#125;<br>				sb.setLength(<span class="hljs-number">0</span>);<br>				sb.append(<span class="hljs-built_in">this</span>.getString(<span class="hljs-string">&quot;set&quot;</span>, <span class="hljs-string">&quot;u&quot;</span> + i, <span class="hljs-string">&quot;name&quot;</span> + i));<br><span class="hljs-comment">//sb.append(this.getString(&quot;hmset&quot;, &quot;usr&quot; + i, &quot;userid&quot;, &quot;usr&quot; + i, &quot;username&quot;, &quot;usrname&quot; + i));</span><br>				w.append(sb.toString());<br>			&#125;<br>		&#125; <span class="hljs-keyword">catch</span> (UnsupportedEncodingException e) &#123;<br>			e.printStackTrace();<br>		&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>			e.printStackTrace();<br>		&#125; <span class="hljs-keyword">finally</span> &#123;<br>			<span class="hljs-keyword">try</span> &#123;<br>				w.flush();<br>				w.close();<br>			&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>				e.printStackTrace();<br>			&#125;<br><br>		&#125;<br>		<span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>		System.out.println(<span class="hljs-string">&quot;耗时: &quot;</span>+(endTime - startTime)/<span class="hljs-number">1000</span>+<span class="hljs-string">&quot; s。&quot;</span>);<br>	&#125;<br>&#125;<br><span class="hljs-comment">//查看命令都耗时2.42秒，可以看到管道命令有多快，令人乍舌！</span><br></code></pre></td></tr></table></figure>

<h2 id="缓存预热"><a href="#缓存预热" class="headerlink" title="缓存预热"></a>缓存预热</h2><ul>
<li><p>当数据量达几百g时，如果让其程序来缓存，无疑对数据库会造成比较大的压力，而实现对热点数据生成这样的导入文件，执行管道命令快速导入，这样就减少了对数据库的压力，让整个程序更加稳健的接受海量用户的访问。</p>
</li>
<li><p>常见问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">[root<span class="hljs-meta">@localhost</span> redis]# cat d.txt |redis-cli --pipe<br>ERR Protocol error: too big mbulk count string<br>Error writing to the server: Connection reset by peer<br></code></pre></td></tr></table></figure>

<ul>
<li>文件太大，和所分配的内存大小密切相关，内存太少则会导致文件太大导入失败。</li>
</ul>
</li>
</ul>
<h1 id="Redis启动两个服务"><a href="#Redis启动两个服务" class="headerlink" title="Redis启动两个服务"></a>Redis启动两个服务</h1><h2 id="防火墙设置"><a href="#防火墙设置" class="headerlink" title="防火墙设置"></a>防火墙设置</h2><ul>
<li>关闭防火墙</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">[root<span class="hljs-meta">@localhost</span> ~]# systemctl stop firewalld			#关闭防火墙<br>[root<span class="hljs-meta">@localhost</span> ~]# systemctl disable firewalld			#开机禁用<br></code></pre></td></tr></table></figure>

<h2 id="开启服务"><a href="#开启服务" class="headerlink" title="开启服务"></a>开启服务</h2><ul>
<li>参数：port端口，daemonize后台运行，protected-mode保护模式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">redis-server --port <span class="hljs-number">6379</span> --daemonize yes --<span class="hljs-keyword">protected</span>-mode no<br>redis-server --port <span class="hljs-number">6380</span> --daemonize yes --<span class="hljs-keyword">protected</span>-mode no<br></code></pre></td></tr></table></figure>

<h1 id="Redis分片"><a href="#Redis分片" class="headerlink" title="Redis分片"></a>Redis分片</h1><h2 id="获取redis客户端"><a href="#获取redis客户端" class="headerlink" title="获取redis客户端"></a>获取redis客户端</h2><ul>
<li><p>获取redis的jar包</p>
<ol>
<li>找到redis的client</li>
</ol>
<p><img src="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/redis_client1.png" srcset="/img/loading.gif" lazyload></p>
<ol start="2">
<li>找到Java项选择Jedis客户端</li>
</ol>
<p><img src="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/jedis_client.png" srcset="/img/loading.gif" lazyload></p>
<ol start="3">
<li>下载jedis的jar包</li>
</ol>
<p><img src="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/jedis_client1.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p>也可以通过网上找Maven依赖依赖jedis的jar包</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;project xmlns=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>	xsi:schemaLocation=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;<br>	&lt;modelVersion&gt;<span class="hljs-number">4.0</span><span class="hljs-number">.0</span>&lt;/modelVersion&gt;<br>	&lt;groupId&gt;cn.tedu&lt;/groupId&gt;<br>	&lt;artifactId&gt;hello&lt;/artifactId&gt;<br>	&lt;version&gt;<span class="hljs-number">0.0</span><span class="hljs-number">.1</span>-SNAPSHOT&lt;/version&gt;<br>	&lt;packaging&gt;jar&lt;/packaging&gt;<br><br>	&lt;dependencies&gt;<br>		&lt;dependency&gt;<br>			&lt;groupId&gt;redis.clients&lt;/groupId&gt;<br>			&lt;artifactId&gt;jedis&lt;/artifactId&gt;<br>			&lt;version&gt;<span class="hljs-number">2.9</span><span class="hljs-number">.0</span>&lt;/version&gt;<br>		&lt;/dependency&gt;<br>		&lt;dependency&gt;<br>			&lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br>			&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;<br>			&lt;version&gt;<span class="hljs-number">1.6</span><span class="hljs-number">.4</span>&lt;/version&gt;<br>		&lt;/dependency&gt;<br>	&lt;/dependencies&gt;<br>&lt;/project&gt;<br></code></pre></td></tr></table></figure>

<h2 id="Jedis简单示例"><a href="#Jedis简单示例" class="headerlink" title="Jedis简单示例"></a>Jedis简单示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> redis;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestRedis</span> &#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>		<span class="hljs-comment">//设置连接服务器IP地址和访问端口</span><br>		<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;192.168.115.115&quot;</span>,<span class="hljs-number">6379</span>);<br>		<br>		<span class="hljs-comment">//单个值</span><br>		<span class="hljs-comment">//jedis.set(&quot;test&quot;, &quot;456789&quot;);				//设置值</span><br>		<span class="hljs-comment">//System.out.println(jedis.get(&quot;test&quot;));		//获取值</span><br>		<br>		<span class="hljs-comment">//多个值</span><br>		<span class="hljs-comment">//jedis.mset(&quot;test1&quot;,&quot;1&quot;,&quot;test2&quot;,&quot;2&quot;);</span><br>		List&lt;String&gt; oList = jedis.mget(<span class="hljs-string">&quot;test1&quot;</span>,<span class="hljs-string">&quot;test2&quot;</span>);<br>		<span class="hljs-keyword">for</span>(String s : oList)&#123;<br>			System.out.println(s);<br>		&#125;<br>		<br>		jedis.close();	<span class="hljs-comment">//关闭</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="使用连接池"><a href="#使用连接池" class="headerlink" title="使用连接池"></a>使用连接池</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.redis;<br><br><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;<br><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisPoolDemo</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 构建连接池配置信息</span><br>        <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">jedisPoolConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();<br>        <span class="hljs-comment">// 设置最大连接数</span><br>        jedisPoolConfig.setMaxTotal(<span class="hljs-number">200</span>);<br><br>        <span class="hljs-comment">// 构建连接池</span><br>        <span class="hljs-type">JedisPool</span> <span class="hljs-variable">jedisPool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(jedisPoolConfig, <span class="hljs-string">&quot; 192.168.163.101&quot;</span>, <span class="hljs-number">6379</span>);<br><br>        <span class="hljs-comment">// 从连接池中获取连接</span><br>        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> jedisPool.getResource();<br><br>        <span class="hljs-comment">// 读取数据</span><br>        System.out.println(jedis.get(<span class="hljs-string">&quot;name&quot;</span>));<br><br>        <span class="hljs-comment">// 将连接还回到连接池中</span><br>        jedisPool.returnResource(jedis);<br><br>        <span class="hljs-comment">// 释放连接池</span><br>        jedisPool.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="分片操作"><a href="#分片操作" class="headerlink" title="分片操作"></a>分片操作</h2><ul>
<li>实现分布式缓存，Redis多个节点的透明访问</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Test</span>	<span class="hljs-comment">//分片</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shard</span><span class="hljs-params">()</span>&#123;<br>	<br>	<br>	<span class="hljs-comment">//构造各个节点链接信息，host和port</span><br>	List&lt;JedisShardInfo&gt; infoList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;JedisShardInfo&gt;();<br>	<span class="hljs-type">JedisShardInfo</span> <span class="hljs-variable">info1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisShardInfo</span>(<span class="hljs-string">&quot;192.168.163.200&quot;</span>,<span class="hljs-number">6379</span>);<br>	<span class="hljs-comment">//info1.setPassword(&quot;123456&quot;);</span><br>	infoList.add(info1);<br>	<span class="hljs-type">JedisShardInfo</span> <span class="hljs-variable">info2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisShardInfo</span>(<span class="hljs-string">&quot;192.168.163.200&quot;</span>,<span class="hljs-number">6380</span>);<br>	infoList.add(info2);<br>	<span class="hljs-type">JedisShardInfo</span> <span class="hljs-variable">info3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisShardInfo</span>(<span class="hljs-string">&quot;192.168.163.200&quot;</span>,<span class="hljs-number">6381</span>);<br>	infoList.add(info3);<br>	<br>	<span class="hljs-comment">//分片jedis</span><br>	<br>	<span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();<br>	config.setMaxTotal(<span class="hljs-number">500</span>);	<span class="hljs-comment">//最大链接数</span><br>	<br>	<span class="hljs-type">ShardedJedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShardedJedisPool</span>(config, infoList);<br>	<span class="hljs-comment">//ShardedJedis jedis = new ShardedJedis(infoList);</span><br>	<span class="hljs-type">ShardedJedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> pool.getResource();	<span class="hljs-comment">//从pool中获取</span><br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10</span>;i++)&#123;<br>		jedis.set(<span class="hljs-string">&quot;n&quot;</span>+i, <span class="hljs-string">&quot;t&quot;</span>+i);<br>	&#125;<br>	System.out.println(jedis.get(<span class="hljs-string">&quot;n9&quot;</span>));<br>	jedis.close();<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="分片原理"><a href="#分片原理" class="headerlink" title="分片原理"></a>分片原理</h2><ul>
<li>在分布式集群中，对机器的添加删除，或者机器故障后自动脱离集群这些操作是分布式集群管理最基本的功能。如果采用常用的hash(object)%N算法，那么在有机器添加或者删除后，很多原有的数据就无法找到了，这样严重的违反了单调性原则。（hash取余算法一般用在集合中）</li>
</ul>
<p><img src="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/hash1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="Hash一致性算法"><a href="#Hash一致性算法" class="headerlink" title="Hash一致性算法"></a>Hash一致性算法</h2><ul>
<li>一致性哈希算法在1997年由麻省理工学院提出。</li>
<li>hash取余产生的问题：新增节点、删除节点会让绝大多数的缓存失效，除了导致性能骤降外很有可能会压垮后台服务器。</li>
<li>哈希一致性算法<ul>
<li>解决对象：当集群中的节点新增或挂掉的时候，要对已有的节点的影响降到最小</li>
<li>解决方法：<ol>
<li><strong>对缓存的object(key值)和Node(服务器节点值)使用同一个hash函数</strong>(实际不需要完全一致，但至少保证产生的hash空间相同)，<strong>让他们映射到同一个hash空间中去</strong>，当然这很容易实现，因为大多数的hash函数都是返回uint32类型，其空间即为1~232 232-1（2^32 &#x3D; 4294 967 296，近43亿）</li>
<li>**然后各个Node就将整个hash空间分割成多个interval空间，然后对于每个缓存对象object，都按照顺时针方向遇到的第一个Node负责缓存它。**通过这种方法，在新增加Node和删除Node的时候，只会对顺时针方向遇到的第一个Node负责的空间造成影响，其余的空间都仍然有效。</li>
<li><strong>同时在以上基础上添加虚拟Node的实现</strong>，即Node-1会有多个分身Node-1-1，Node-1-2等虚拟节点来替自身回收散布在Hash环上的值。通过这种方法，在添加删除Redis服务器或初始Hash计算Node值位置不平均时，保证object仍然能平均被分配给对应的Node服务器</li>
</ol>
</li>
</ul>
</li>
</ul>
<p><img src="http://ypimage.oss-cn-shenzhen.aliyuncs.com/upload_image/redis/hash2.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>注意：虽然虚拟并不能百分百的解决缓存命中失效的问题，但把问题缩小化，这样影响面小，即使缓存失效，数据库也能承受起用户的负载，从而稳定过渡。</li>
</ul>
<h2 id="Hash一致性的特征"><a href="#Hash一致性的特征" class="headerlink" title="Hash一致性的特征"></a>Hash一致性的特征</h2><h3 id="单调性-Monotonicity"><a href="#单调性-Monotonicity" class="headerlink" title="单调性(Monotonicity)"></a>单调性(Monotonicity)</h3><p><strong>单调性是指如果已经有一些请求通过哈希分派到了相应的服务器进行处理，又有新的服务器加入到系统中时候，应保证原有的请求可以被映射到原有的或者新的服务器中去，而不会被映射到原来的其它服务器上去。</strong></p>
<h3 id="分散性-Spread"><a href="#分散性-Spread" class="headerlink" title="分散性(Spread)"></a>分散性(Spread)</h3><p>分布式环境中，客户端请求时候可能不知道所有服务器的存在，可能只知道其中一部分服务器，在客户端看来他看到的部分服务器会形成一个完整的hash环。如果多个客户端都把部分服务器作为一个完整hash环，那么可能会导致，同一个用户的请求被路由到不同的服务器进行处理。这种情况显然是应该避免的，因为它不能保证同一个用户的请求落到同一个服务器。所谓分散性是指上述情况发生的严重程度。好的哈希算法应尽量避免尽量降低分散性。<br>一致性hash具有很低的分散性。</p>
<h3 id="平衡性-Balance"><a href="#平衡性-Balance" class="headerlink" title="平衡性(Balance)"></a>平衡性(Balance)</h3><p>平衡性也就是说负载均衡，是指客户端hash后的请求应该能够分散到不同的服务器上去。一致性hash可以做到每个服务器都进行处理请求，但是不能保证每个服务器处理的请求的数量大致相同。</p>
<h3 id="负载-Load"><a href="#负载-Load" class="headerlink" title="负载(Load)"></a>负载(Load)</h3><p>负载问题实际上是从另一个角度看待<u>分散性</u>问题。既然不同的终端可能将相同的内容映射到不同的缓冲区中，那么对于一个特定的缓冲区而言，也可能被不同的用户映射为不同的内容。与分散性一样，这种情况也是应当避免的，因此好的哈希算法应能够尽量降低缓冲的负荷。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Redis/" class="category-chain-item">Redis</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Redis/" class="print-no-link">#Redis</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Redis</div>
      <div>https://andrewjiao.github.io/2019/07/01/Redis/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Andrew_Jiao</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2019年7月1日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2019/07/12/Docker/" title="Docker容器技术">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Docker容器技术</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2019/06/28/other/poetry_%E5%8D%AB%E9%9D%92/" title="出塞二首 其一">
                        <span class="hidden-mobile">出塞二首 其一</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>
</html>
